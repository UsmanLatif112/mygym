{% extends "base.html" %}
{% block content %}
<h1 class="page-title">Add Employee</h1>
<div class="add-customer-full-bg">
  <div class="add-customer-card customer-card">
    <form method="POST">
      {{ form.hidden_tag() }}
      <div class="form-block">
        <div class="form-block">
        <label for="name">Employee Name:</label>
        {{ form.name(class_="form-input", id="name") }}
        {% for error in form.name.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
        </div>
        <div class="form-block">
        <label for="cnic">Employee CNIC:</label>
        {{ form.cnic(class_="form-input", id="cnic") }}
        {% for error in form.cnic.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
        </div>
      <div class="form-block">
        <label for="employment_type">Employment Type:</label>
        {{ form.employment_type(class_="form-input", id="employment_type") }}
        {% for error in form.employment_type.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-block">
        <label for="timing">Timing:</label>
        {{ form.timing(class_="form-input", id="timing") }}
        {% for error in form.timing.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-block">
        <label for="shift">Shift:</label>
        {{ form.shift(class_="form-input", id="shift") }}
        {% for error in form.shift.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-block">
        <label for="status">Status:</label>
        {{ form.status(class_="form-input", id="status") }}
        {% for error in form.status.errors %}
        <span class="form-error">{{ error }}</span>
        {% endfor %}
      </div>
      <div class="form-block">
        {{ form.submit(class_="leet-btn") }}
      </div>
    </form>
  </div>
</div>


<style>
.toast-error {
    position: fixed;
    top: 36px;
    right: 36px;
    min-width: 260px;
    background: #d90429;
    color: #fff;
    padding: 16px 30px;
    border-radius: 8px;
    font-size: 1.08em;
    box-shadow: 0 4px 24px #0002;
    z-index: 9999;
    opacity: 0.97;
    animation: toast-in 0.3s, toast-out 0.4s 2.4s forwards;
    font-weight: 600;
    letter-spacing: 0.2px;
}
@keyframes toast-in { from {opacity: 0; transform: translateY(-20px);} to {opacity: 0.97; transform: translateY(0);} }
@keyframes toast-out { from {opacity: 0.97;} to {opacity: 0;} }
</style>
{% if form.cnic.errors %}
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var toast = document.createElement('div');
      toast.className = 'toast-error';
      toast.innerText = "{{ form.cnic.errors[0]|escape }}";
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 2800);
    });
  </script>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cnicInput = document.getElementById('cnic');
    const cnicError = document.createElement('span');
    cnicError.className = 'form-error';
    cnicInput.parentNode.appendChild(cnicError);

    cnicInput.addEventListener('input', function() {
        const cnic = cnicInput.value.trim();
        if (!cnic) {
            cnicError.textContent = '';
            return;
        }
        // Send AJAX POST to check CNIC
        fetch('{{ url_for("check_employee_cnic") }}', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'cnic=' + encodeURIComponent(cnic)
        })
        .then(response => response.json())
        .then(data => {
            if (data.exists) {
                cnicError.textContent = 'This employee CNIC already exists.';
            } else {
                cnicError.textContent = '';
            }
        });
    });
});
</script>

    
{% endblock %}
